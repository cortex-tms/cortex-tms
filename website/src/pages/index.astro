---
/**
 * Homepage - Simple Layout
 *
 * Uses SimpleLayout (header - main - footer) without sidebar
 */
import SimpleLayout from '../layouts/SimpleLayout.astro'
import GlassPanel from '../components/GlassPanel.astro'
import GlassButton from '../components/GlassButton.astro'
import Blockquote from '../components/Blockquote.astro'
import MetricsShowcase from '../components/MetricsShowcase.astro'
import PillarsSection from '../components/PillarsSection.astro'
import SustainabilityBadge from '../components/SustainabilityBadge.astro'
import CTABox from '../components/CTABox.astro'
import ScriptedTerminal from '../components/ScriptedTerminal.astro'
import GuardianShowcase from '../components/GuardianShowcase.astro'
import TokenCounter from '../components/TokenCounter.astro'
import ComparisonMatrix from '../components/ComparisonMatrix.astro'
import FeaturedBlogPost from '../components/FeaturedBlogPost.astro'
import InstallationTerminals from '../components/InstallationTerminals.astro'
import {
  Flame,
  Shield,
  ChartColumn,
  FileText,
  Key,
  Zap,
  ArrowRight,
} from '@lucide/astro'
import { getCollection } from 'astro:content'
import type {
  HeroEntry,
  FeatureEntry,
  StepEntry,
  InstallationEntry,
  BlockquoteEntry,
  CTAEntry,
  DemoTerminalEntry,
  GuardianShowcaseEntry,
  IconType,
} from '../types/homepage'
import '../styles/homepage.css'

// Get content from collections
const allHomepageContent = await getCollection('homepage')

// Get hero content
const heroEntry = allHomepageContent.find(
  (entry): entry is HeroEntry => entry.data.type === 'hero'
)
const hero = heroEntry?.data

// Get features
const features = allHomepageContent
  .filter((entry): entry is FeatureEntry => entry.data.type === 'feature')
  .sort((a, b) => a.data.order - b.data.order)

// Get steps
const steps = allHomepageContent
  .filter((entry): entry is StepEntry => entry.data.type === 'step')
  .sort((a, b) => a.data.number - b.data.number)

// Get blockquote
const blockquoteEntry = allHomepageContent.find(
  (entry): entry is BlockquoteEntry => entry.data.type === 'blockquote'
)

// Get CTA
const ctaEntry = allHomepageContent.find(
  (entry): entry is CTAEntry => entry.data.type === 'cta'
)
const cta = ctaEntry?.data

// Get demo terminal
const demoTerminalEntry = allHomepageContent.find(
  (entry): entry is DemoTerminalEntry => entry.data.type === 'demo-terminal'
)

// Get guardian showcase
const guardianShowcaseEntry = allHomepageContent.find(
  (entry): entry is GuardianShowcaseEntry => entry.data.type === 'guardian-showcase'
)

// Icon mapping
const iconMap: Record<IconType, typeof Flame> = {
  flame: Flame,
  shield: Shield,
  'bar-chart': ChartColumn,
  'file-text': FileText,
  key: Key,
  zap: Zap,
}
---

<SimpleLayout
  title='Cortex TMS - AI Governance Platform'
  description='Stop wasting tokens. Stop burning GPU cycles on old docs. Reduce AI API costs by up to 10x with Green Governance.'
  lang='en'
  dir='ltr'
>
  {/* Ambient background gradients */}
  <div class='liquid-ambient-bg'></div>

  <div class='homepage-container'>
    {/* Hero Section */}
    {hero && (
      <div class='hero-section'>
        <h1 class='hero-title'>{hero.title}</h1>
        <p class='hero-subtitle'>{hero.subtitle}</p>
        <p class='hero-tagline'>{hero.tagline}</p>
        <p class='hero-description' set:html={hero.description} />
        <div class='hero-actions'>
          <GlassButton
            variant={hero.primaryButton.variant as 'neon' | 'prism'}
            href={hero.primaryButton.href}
          >
            {hero.primaryButton.text}
          </GlassButton>
          {hero.secondaryButton && (
            <GlassButton
              variant={hero.secondaryButton.variant as 'neon' | 'prism'}
              href={hero.secondaryButton.href}
            >
              {hero.secondaryButton.text}
            </GlassButton>
          )}
        </div>
      </div>
    )}

    {/* CLI Demo */}
    <section class='content-section'>
      <h2 class='section-label'>See It In Action</h2>
      <ScriptedTerminal />
    </section>

    {/* Featured Blog Post */}
    <section class='content-section'>
      <h2 class='section-label'>From the Blog</h2>
      <FeaturedBlogPost />
    </section>

    {/* Three Pillars */}
    <section class='content-section'>
      <h2 class='section-label'>Three Pillars, Measurable Results</h2>
      <PillarsSection />

      {blockquoteEntry && (
        <Blockquote author={blockquoteEntry.data.author}>
          {blockquoteEntry.body}
        </Blockquote>
      )}
    </section>

    {/* Guardian Showcase */}
    <section class='content-section'>
      <h2 class='section-label'>Guardian CLI: Semantic Validation</h2>
      <GuardianShowcase />
    </section>

    {/* Token Savings Proof */}
    <section class='content-section'>
      <h2 class='section-label'>Real Numbers, Real Savings</h2>
      <TokenCounter />
      <MetricsShowcase />
    </section>

    {/* Comparison Matrix */}
    <section class='content-section'>
      <h2 class='section-label'>Compare Your Options</h2>
      <ComparisonMatrix />
    </section>

    {/* Green AI Development Badge */}
    <section class='content-section'>
      <h2 class='section-label'>Green AI Development</h2>
      <SustainabilityBadge />
    </section>

    {/* Quick Installation */}
    <section class='content-section'>
      <h2 class='section-label'>Quick Installation</h2>
      <InstallationTerminals />
    </section>

    {/* Key Features */}
    <section class='content-section'>
      <h2 class='section-label'>How It Works</h2>
      <div class='glass-grid'>
        {
          features.map((feature) => {
            const Icon = iconMap[feature.data.icon]
            return (
              <GlassPanel variant='bordered' tilt='full' liquidBlob>
                <div class='feature-card-content'>
                  <div class='feature-icon-wrapper'>
                    <Icon size={40} stroke-width='1.5' />
                  </div>
                  <h3 class='feature-card-title'>
                    {feature.data.title}
                  </h3>
                  <p
                    class='feature-card-description'
                    set:html={feature.body}
                  />
                </div>
              </GlassPanel>
            )
          })
        }
      </div>
    </section>

    {/* Getting Started Steps */}
    <section class='content-section'>
      <h2 class='section-label'>Get Started in 3 Steps</h2>
      <div class='roadmap-container'>
        {
          steps.map((step, index) => (
            <>
              <div class='roadmap-step' data-step={step.data.number}>
                <GlassPanel variant='bordered' liquidBlob>
                  <div class='step-card-content'>
                    <div class='step-badge'>
                      <span class='step-number'>{step.data.number}</span>
                    </div>
                    <h3 class='step-card-title'>{step.data.title}</h3>
                    <p class='step-card-description' set:html={step.body} />
                  </div>
                </GlassPanel>
              </div>
              {index < steps.length - 1 && (
                <div class='roadmap-connector'>
                  <ArrowRight size={32} stroke-width={2} class='connector-arrow' />
                </div>
              )}
            </>
          ))
        }
      </div>
    </section>

    {/* Ready to Get Started */}
    {cta && (
      <section class='content-section'>
        <h2 class='section-label'>Ready to Get Started?</h2>
        <CTABox
          title={cta.title}
          description={cta.description}
          primaryButtonText={cta.primaryButton.text}
          primaryButtonHref={cta.primaryButton.href}
          secondaryButtonText={cta.secondaryButton?.text}
          secondaryButtonHref={cta.secondaryButton?.href}
        />
      </section>
    )}
  </div>

  <style>
    .homepage-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1rem;
      position: relative;
      z-index: 1;
    }

    /* Hero Section */
    .hero-section {
      text-align: center;
      padding: 4rem 0 6rem;
    }

    .hero-title {
      font-size: clamp(3rem, 8vw, 5rem);
      font-weight: 700;
      margin: 0 0 0.5rem 0;
      background: linear-gradient(
        135deg,
        var(--sl-color-white),
        var(--sl-color-accent-high)
      );
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-subtitle {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--sl-color-accent);
      margin: 0 0 1.5rem 0;
    }

    .hero-tagline {
      font-size: 1.5rem;
      line-height: 1.6;
      color: var(--sl-color-gray-1);
      font-weight: 600;
      max-width: 800px;
      margin: 0 auto 1rem;
    }

    .hero-description {
      font-size: 1.125rem;
      line-height: 1.6;
      color: var(--sl-color-gray-2);
      max-width: 800px;
      margin: 0 auto 2.5rem;
    }

    .hero-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Content Sections */
    .content-section {
      margin-bottom: 5rem;
    }

    .content-section h2 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 3rem;
      color: var(--sl-color-text);
    }

    .content-section p {
      font-size: 1.125rem;
      line-height: 1.75;
      color: var(--sl-color-gray-2);
      margin-bottom: 1.5rem;
    }

    /* Pillars Grid */
    .pillars-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }

    /* Sustainability Badge Section */
    .sustainability-badge-section {
      margin-bottom: 5rem;
    }

    .sustainability-badge-section h2 {
      background: linear-gradient(
        135deg,
        var(--sl-color-accent),
        var(--sl-color-accent-high)
      );
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero-section {
        padding: 2rem 0 3rem;
      }

      .hero-title {
        font-size: 2.5rem;
      }

      .hero-subtitle {
        font-size: 1.25rem;
      }

      .hero-tagline {
        font-size: 1.125rem;
      }

      .hero-description {
        font-size: 1rem;
      }

      .content-section h2 {
        font-size: 2rem;
      }

      .content-section p {
        font-size: 1rem;
      }

      .pillars-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</SimpleLayout>
