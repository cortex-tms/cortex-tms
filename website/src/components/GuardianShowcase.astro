---
/**
 * GuardianShowcase - Description card + terminal demo side by side
 */
import GlassPanel from './GlassPanel.astro';
import TerminalWindow from './TerminalWindow.astro';
import { Shield, CheckCircle } from '@lucide/astro';
import { getCollection } from 'astro:content';
import type { GuardianShowcaseEntry } from '../types/homepage';
import '../styles/guardian-showcase.css';

const allContent = await getCollection('homepage');
const entry = allContent.find(
  (e): e is GuardianShowcaseEntry => e.data.type === 'guardian-showcase'
);

if (!entry) throw new Error('Guardian showcase content not found');
---

<div class="guardian-showcase">
  {/* Card 1: Description */}
  <GlassPanel variant="bordered" liquidBlob>
    <div class="panel-content">
      <div class="guardian-icon">
        <Shield size={48} stroke-width="1.5" />
      </div>
      <h3 class="guardian-title">{entry.data.title}</h3>
      <p class="guardian-subtitle">{entry.data.subtitle}</p>

      <div class="guardian-features">
        {entry.data.features?.map((feature) => (
          <div class="feature-item">
            <CheckCircle size={20} />
            <span>{feature}</span>
          </div>
        )) || (
          <>
            <div class="feature-item">
              <CheckCircle size={20} />
              <span>Zod validation for semantic checking</span>
            </div>
            <div class="feature-item">
              <CheckCircle size={20} />
              <span>Safe Mode: Read-only analysis (≥80% confidence)</span>
            </div>
            <div class="feature-item">
              <CheckCircle size={20} />
              <span>Minimizes false positives and false negatives</span>
            </div>
            <div class="feature-item">
              <CheckCircle size={20} />
              <span>Catches pattern drift grep can't detect</span>
            </div>
          </>
        )}
      </div>

      <a href={entry.data.docsLink} class="guardian-link">
        Learn more about Guardian →
      </a>
    </div>
  </GlassPanel>

  {/* Card 2: Terminal Demo */}
  <TerminalWindow title="Guardian Safe Mode">
    <div class="terminal-line">
      <span class="terminal-prompt">$</span>
      <span class="terminal-command">npx cortex-tms review src/commands/init.ts --safe</span>
    </div>

    <div class="terminal-output">
      <div class="output-line guardian-header">
        <Shield size={16} />
        <span>Guardian: Semantic Validation</span>
      </div>
      <div class="output-line success">
        <CheckCircle size={16} />
        <span>Pattern compliance verified</span>
      </div>
      <div class="output-line success">
        <CheckCircle size={16} />
        <span>Safe Mode: No file operations executed</span>
      </div>
      <div class="output-line success">
        <CheckCircle size={16} />
        <span>0 violations found</span>
      </div>
    </div>
  </TerminalWindow>
</div>

<style>
  .terminal-line   { margin-bottom: 1rem; }
  .terminal-prompt { color: var(--sl-color-accent); margin-right: 0.5rem; user-select: none; }
  .terminal-command { color: #fbbf24; }

  .terminal-output { display: flex; flex-direction: column; gap: 0.5rem; }
  .output-line     { display: flex; align-items: center; gap: 0.75rem; color: #d1d5db; }
  .guardian-header { color: #67e8f9; font-weight: 600; }
  .success         { color: #4ade80; }

  /* Light mode */
  :root[data-theme='light'] .terminal-command  { color: #92400e; }
  :root[data-theme='light'] .output-line       { color: #374151; }
  :root[data-theme='light'] .guardian-header   { color: #0e7490; }
  :root[data-theme='light'] .success           { color: #15803d; }
</style>
